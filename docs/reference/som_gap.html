<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Self-Organizing Map and Selection of k — som_gap • rassta</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Self-Organizing Map and Selection of k — som_gap" />
<meta property="og:description" content="Produces a low-dimensional representation of the input feature space for
subsequent estimation of the &quot;optimal&quot; number of clusters (k) in a
multivariate dataset. The dimensionality reduction is based on the
self-organizing map technique (SOM) of Kohonen (1982; 1990), and implemented
in R by the function supersom of Wehrens and
Kruisselbrink (2018). To estimate the optimal k, the partitioning
around medoids (PAM) of Kaufman and Rousseeuw (1990), coupled with the gap
statistic of Tibshirani et al. (2001), is performed on the SOM's codebook
vectors. This is achieved by internally calling pam
and clusGap (Maechler et al., 2021). See
Details for a brief theoretical background." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rassta</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/classunits.html">Classification Units</a>
    </li>
    <li>
      <a href="../articles/modeling.html">Predictive Modeling Engine</a>
    </li>
    <li>
      <a href="../articles/sampling.html">Stratified Non-Probability Sampling</a>
    </li>
    <li>
      <a href="../articles/signature.html">Spatial Signature of Classification Units</a>
    </li>
    <li>
      <a href="../articles/similarity.html">Landscape Similarity to Stratification Units</a>
    </li>
    <li>
      <a href="../articles/stratunits.html">Stratification Units</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bafuentes/rassta/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Self-Organizing Map and Selection of k</h1>
    <small class="dont-index">Source: <a href='https://github.com/bafuentes/rassta/blob/master/R/som_gap.r'><code>R/som_gap.r</code></a></small>
    <div class="hidden name"><code>som_gap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces a low-dimensional representation of the input feature space for
subsequent estimation of the "optimal" number of clusters (<em>k</em>) in a
multivariate dataset. The dimensionality reduction is based on the
self-organizing map technique (SOM) of Kohonen (1982; 1990), and implemented
in R by the function <code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code> of Wehrens and
Kruisselbrink (2018). To estimate the optimal <em>k</em>, the partitioning
around medoids (PAM) of Kaufman and Rousseeuw (1990), coupled with the gap
statistic of Tibshirani et al. (2001), is performed on the SOM's codebook
vectors. This is achieved by internally calling <code><a href='https://rdrr.io/pkg/cluster/man/pam.html'>pam</a></code>
and <code><a href='https://rdrr.io/pkg/cluster/man/clusGap.html'>clusGap</a></code> (Maechler et al., 2021). See
<em>Details</em> for a brief theoretical background.</p>
    </div>

    <pre class="usage"><span class='fu'>som_gap</span><span class='op'>(</span>
  <span class='va'>var.rast</span>,
  xdim <span class='op'>=</span> <span class='fl'>12</span>,
  ydim <span class='op'>=</span> <span class='fl'>12</span>,
  topo <span class='op'>=</span> <span class='st'>"hexagonal"</span>,
  neighbourhood.fct <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  rlen <span class='op'>=</span> <span class='fl'>600</span>,
  dist.fcts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sumofsquares"</span>, <span class='st'>"manhattan"</span><span class='op'>)</span>,
  mode <span class='op'>=</span> <span class='st'>"pbatch"</span>,
  <span class='va'>K.max</span>,
  stand <span class='op'>=</span> <span class='cn'>FALSE</span>,
  B <span class='op'>=</span> <span class='fl'>500</span>,
  d.power <span class='op'>=</span> <span class='fl'>2</span>,
  spaceH0 <span class='op'>=</span> <span class='st'>"original"</span>,
  method <span class='op'>=</span> <span class='st'>"globalSEmax"</span>,
  SE.factor <span class='op'>=</span> <span class='fl'>1</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>var.rast</th>
      <td><p>SpatRaster, as in <code><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></code>. This Multi-layer
SpatRaster must contain <em>n</em> continuous variables from which the SOM
will be created.</p></td>
    </tr>
    <tr>
      <th>xdim</th>
      <td><p>Integer. Horizontal dimension of the SOM's grid. Default: 12</p></td>
    </tr>
    <tr>
      <th>ydim</th>
      <td><p>Integer. Vertical dimension of the SOM's grid. Default: 12</p></td>
    </tr>
    <tr>
      <th>topo</th>
      <td><p>Character. Topology of the SOM's grid. Options = "rectangular",
"hexagonal". Default: "hexagonal"</p></td>
    </tr>
    <tr>
      <th>neighbourhood.fct</th>
      <td><p>Character. Neighborhood of the SOM's grid. Options =
"bubble", "gaussian". Default: "gaussian"</p></td>
    </tr>
    <tr>
      <th>rlen</th>
      <td><p>Integer. Number of times the complete dataset will be presented
to the SOM's network. Default: 600</p></td>
    </tr>
    <tr>
      <th>dist.fcts</th>
      <td><p>Character. Vector of length 2 containing the distance
functions to use for SOM (First element, options = "sumofsquares",
"euclidean", "manhattan") and for PAM (second element, options =
"euclidean", "manhattan"). Default: c("sumofsquares", "manhattan")</p></td>
    </tr>
    <tr>
      <th>mode</th>
      <td><p>Character. Type of learning algorithm. Options are “online",
"batch", and "pbatch". Default: "pbatch"</p></td>
    </tr>
    <tr>
      <th>K.max</th>
      <td><p>Integer. Maximum number of clusters to consider, must be at
least two (2).</p></td>
    </tr>
    <tr>
      <th>stand</th>
      <td><p>Boolean. For PAM function, does SOM's codebook vectors need to
be standardized? Default: FALSE</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>Integer. Number of bootstrap samples for the gap statistic. Default:
500</p></td>
    </tr>
    <tr>
      <th>d.power</th>
      <td><p>Integer. Positive Power applied to euclidean distances for the
gap statistic. Default: 2</p></td>
    </tr>
    <tr>
      <th>spaceH0</th>
      <td><p>Character. Space of the reference distribution for the gap
statistic. Options = "scaledPCA", "original" (See <strong>Details</strong>).
Default: "original"</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Character. Optimal k selection criterion for the gap statistic.
Options = "globalmax", "firstmax", "Tibs2001SEmax", "firstSEmax",
"globalSEmax". See  <code><a href='https://rdrr.io/pkg/cluster/man/clusGap.html'>clusGap</a></code> for more details.
Default: "globalSEmax"</p></td>
    </tr>
    <tr>
      <th>SE.factor</th>
      <td><p>Numeric. Factor to feed into the standard error rule for the
gap statistic. Only applicable for methods based on standard error (SE).
See <code><a href='https://rdrr.io/pkg/cluster/man/clusGap.html'>clusGap</a></code> for more details. Default: 1</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments as for <code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><strong>SOM</strong>: An object of class <strong>kohonen</strong> (see
<code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code>). The components of class kohonen returned by
this function are: (1) <em>data</em> = original input matrix, (2)
<em>unit.classif</em> = winning units for all observations, (3)
<em>distances</em> = distance between each observation and its corresponding
winning unit, (4) <em>grid</em> = object of class <strong>somgrid</strong> (see
<code><a href='https://rdrr.io/pkg/kohonen/man/unit.distances.html'>somgrid</a></code>), (5) <em>codes</em> = matrix of codebook
vectors, (6) <em>changes</em> = matrix of mean average deviations from codebook
vectors, (7) <em>dist.fcts</em> = selected distance function, and other
arguments passed to <code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code> (e.g., <em>radius</em>,
<em>distance.weights</em>, etc.). Note that components 1, 2, and 3 will only be
returned if <em>keep.data = TRUE</em>, which is the default.</p>
<p><strong>SOMdist</strong>: Object of class <strong>dist</strong>. Matrix of pairwise distances
calculated from the SOM's codebook vectors.</p>
<p><strong>SOMgap</strong>: Object of class <strong>clusGap</strong>. The main component of
class clusGap returned by this function is <em>Tab</em>, which is a matrix of
the gap statistic results (see <code><a href='https://rdrr.io/pkg/cluster/man/clusGap.html'>clusGap</a></code>). Additional
components are the arguments passed to the function (i.e., <em>spaceH0</em>,
<em>B</em>), the PAM function, <em>n</em> (number of observations) and
<em>call</em> (the clusGap call-type object).</p>
<p><strong>Kopt</strong>: Optimal <em>k</em>, as selected by arguments <em>method</em> and
(possibly) <em>SE.factor</em>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The clustering of SOM's codebook vectors has been proposed in several works,
notably in that from Vesanto and Alhoniemi (2000). These authors proposed a
two-stage clustering routine as an efficient method to reduce computational
load, while obtaining satisfactory correspondence between the clustered
codebook vectors and the clustered original feature space.</p>
<p>The main purpose of this function is to allow the use of clustering and
k-selection algorithms that may result prohibitive for large datasets, such
as matrices derived from raster layers commonly used during geocomputational
routines. Thus, the SOM's codebook vectors can be subsequently used for the
calculation of distance matrices, which given the large size of their input
feature space, may otherwise be impossible to create due to insufficient
memory allocation capacity. Similarly, robust clustering algorithms that
require full pairwise distance matrices (e.g., hierarchical clustering, PAM)
and/or eigenvalues (e.g., spectral clustering) may also be performed on SOM's
codebook vectors.</p>
<p>Note that <code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code> will internally equalize the
importance (i.e., weights) of variables such that differences in scale will
not affect distance calculations. This behavior can be prevented by setting
<em>normalizeDataLayers = FALSE</em> in additional arguments passed to
<code><a href='https://rdrr.io/pkg/kohonen/man/supersom.html'>supersom</a></code>. Moreover, custom weights can also be passed
through the additional argument <em>user.weights</em>. In such case, user
weights are applied on top of the internal weights.</p>
<p>When working with large matrices, the additional SOM argument
<em>keep.data</em> may be set to FALSE. However, note that by doing so, the
suggested follow-up function for raster products <code><a href='som_pam.html'>som_pam</a></code> will
not work since it requires both original data and winning units.</p>
<p>For the gap statistic, <em>method = "scaledPCA"</em> has resulted in errors for
R sessions with BLAS/LAPACK supported by the Intel Math Kernel Library (MKL).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>L. Kaufman and P. Rousseeuw. Finding groups in data: an introduction to
cluster analysis. John Wiley &amp; Sons, 1990.
doi: <a href='https://doi.org/10.1002/9780470316801'>10.1002/9780470316801</a></p>
<p>T. Kohonen. Self-organized formation of topologically correct feature maps.
Biological cybernetics, 43 (1):59–69, 1982.
doi: <a href='https://doi.org/10.1007/bf00337288'>10.1007/bf00337288</a></p>
<p>T. Kohonen. The self-organizing map. Proceedings of the IEEE,
78(9):1464–1480, 1990. doi: <a href='https://doi.org/10.1016/s0925-2312(98)00030-7'>10.1016/s0925-2312(98)00030-7</a></p>
<p>M. Maechler, P. Rousseeuw, A. Struyf, M. Hubert, and K. Hornik. cluster:
Cluster Analysis Basics and Extensions, 2021.
<a href='https://CRAN.R-project.org/package=cluster'>https://CRAN.R-project.org/package=cluster</a></p>
<p>R. Tibshirani, G. Walther, and T. Hastie. Estimating the number of clusters
in a data set via the gap statistic. Journal of the Royal Statistical
Society: Series B (Statistical Methodology), 63(2):411–423, 2001.
doi: <a href='https://doi.org/10.1111/1467-9868.00293'>10.1111/1467-9868.00293</a></p>
<p>J. Vesanto and E. Alhoniemi. Clustering of the self-organizing map. IEEE
Transactions on Neural Networks, 11(3):586–600, 2000.
doi: <a href='https://doi.org/10.1109/72.846731'>10.1109/72.846731</a></p>
<p>R. Wehrens and J. Kruisselbrink. Flexible self-organizing maps in kohonen
3.0. Journal of Statistical Software, 87(1):1–18, 2018.
doi: <a href='https://doi.org/10.18637/jss.v087.i07'>10.18637/jss.v087.i07</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Functions for Landscape Stratification: 
<code><a href='som_pam.html'>som_pam</a>()</code>,
<code><a href='strata.html'>strata</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/terra/'>terra</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Multi-layer SpatRaster with topographic variables</span></span>
<span class='r-in'><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"exdat"</span>, package <span class='op'>=</span> <span class='st'>"rassta"</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>tf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>p</span>, pattern <span class='op'>=</span> <span class='st'>"^height|^slope|^wetness"</span>,</span>
<span class='r-in'>                 full.names <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span class='r-in'>                <span class='op'>)</span></span>
<span class='r-in'><span class='va'>t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></span><span class='op'>(</span><span class='va'>tf</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Scale topographic variables (mean = 0, StDev = 1)</span></span>
<span class='r-in'><span class='va'>ts</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>t</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Self-organizing map and gap statistic for optimum k</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>963</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>tsom</span> <span class='op'>&lt;-</span> <span class='fu'>som_gap</span><span class='op'>(</span>var.rast <span class='op'>=</span> <span class='va'>ts</span>, xdim <span class='op'>=</span> <span class='fl'>8</span>, ydim <span class='op'>=</span> <span class='fl'>8</span>, rlen <span class='op'>=</span> <span class='fl'>150</span>,</span>
<span class='r-in'>               mode <span class='op'>=</span> <span class='st'>"online"</span>, K.max <span class='op'>=</span> <span class='fl'>6</span>, B <span class='op'>=</span> <span class='fl'>300</span>, spaceH0 <span class='op'>=</span> <span class='st'>"original"</span>,</span>
<span class='r-in'>               method <span class='op'>=</span> <span class='st'>"globalSEmax"</span></span>
<span class='r-in'>              <span class='op'>)</span></span>
<span class='r-in'><span class='co'># Optimum k</span></span>
<span class='r-in'><span class='va'>tsom</span><span class='op'>$</span><span class='va'>Kopt</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 5</span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bryan A. Fuentes, Minerva J. Dorantes, John R. Tipton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


