<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Predictive Modeling Engine — engine • rassta</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Predictive Modeling Engine — engine" />
<meta property="og:description" content="Modeling of spatially varying phenomena based on landscape similarity to
stratification units. If each stratification unit across geographic space
represents a distinct landscape configuration (in terms of multiple landscape
factors and/or factor scales), and if each landscape configuration influences
a phenomenon in a distinct way, then the spatial variability of that
phenomenon can be assessed across a landscape by relating each geographic
location to each distinct landscape configuration. Therefore, the more
similar a geographic location is to the landscape configuration represented
by a given stratification unit, then also the more similar the response of a
phenomenon will be at that location to the typical response for conditions
within the given stratification unit. Both continuous and categorical
response variables are supported. For categorical responses, each category
must be identified by an integer value." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rassta</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/classunits.html">Classification Units</a>
    </li>
    <li>
      <a href="../articles/modeling.html">Predictive Modeling Engine</a>
    </li>
    <li>
      <a href="../articles/sampling.html">Stratified Non-Probability Sampling</a>
    </li>
    <li>
      <a href="../articles/signature.html">Spatial Signature of Classification Units</a>
    </li>
    <li>
      <a href="../articles/similarity.html">Landscape Similarity to Stratification Units</a>
    </li>
    <li>
      <a href="../articles/stratunits.html">Stratification Units</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bafuentes/rassta/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Predictive Modeling Engine</h1>
    <small class="dont-index">Source: <a href='https://github.com/bafuentes/rassta/blob/master/R/engine.r'><code>R/engine.r</code></a></small>
    <div class="hidden name"><code>engine.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Modeling of spatially varying phenomena based on landscape similarity to
stratification units. If each stratification unit across geographic space
represents a distinct landscape configuration (in terms of multiple landscape
factors and/or factor scales), and if each landscape configuration influences
a phenomenon in a distinct way, then the spatial variability of that
phenomenon can be assessed across a landscape by relating each geographic
location to each distinct landscape configuration. Therefore, the more
similar a geographic location is to the landscape configuration represented
by a given stratification unit, then also the more similar the response of a
phenomenon will be at that location to the typical response for conditions
within the given stratification unit. Both continuous and categorical
response variables are supported. For categorical responses, each category
must be identified by an integer value.</p>
    </div>

    <pre class="usage"><span class='fu'>engine</span><span class='op'>(</span>
  res.type <span class='op'>=</span> <span class='st'>"cont"</span>,
  <span class='va'>ls.rast</span>,
  n.win <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='va'>su.repobs</span>,
  <span class='va'>tiles</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  outdir <span class='op'>=</span> <span class='st'>"."</span>,
  tile.rm <span class='op'>=</span> <span class='cn'>TRUE</span>,
  extension <span class='op'>=</span> <span class='st'>".tif"</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>res.type</th>
      <td><p>Character. Type of response to model. Options are "cont" for
continuous, and "cat" for categorical response. Default: "cont"</p></td>
    </tr>
    <tr>
      <th>ls.rast</th>
      <td><p>SpatRaster, as in <code><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></code>. Multi-layer
SpatRaster representing landscape similarities to stratification units.
Only similarities for units with a representative observation are allowed.
Character prefix in the file name of similarities is allowed.</p></td>
    </tr>
    <tr>
      <th>n.win</th>
      <td><p>Integer. Positive number indicating how many winning
stratification units should be considered. See <strong>Details</strong>. Default: 3</p></td>
    </tr>
    <tr>
      <th>su.repobs</th>
      <td><p>Data frame. The first column of this data frame must contain
only the numeric code for the stratification units (without prefix). Each
additional column must contain the value of the representative response
observation for each stratification unit. Multiple response variables are
allowed (one per column). Note that all response variables in the data
frame must share the same type (<em>res.type</em>). See example on issues
related to <strong>non-explicit column names</strong>.</p></td>
    </tr>
    <tr>
      <th>tiles</th>
      <td><p>SpatVector, as in <code><a href='https://rdrr.io/pkg/terra/man/vect.html'>vect</a></code>. Spatial vector of
polygon geometry with the boundaries of the area of interest. This vector
can be subdivided in regions (i.e., tiles) to balance memory allocation and
processing speed (see <strong>Details</strong>). If this vector is tiled, then its
attribute table must only contain an ID column with a unique identifier for
each tile (1,2,...,n). Additionally, This vector must have the same
coordinate reference system as <em>ls.rast</em>.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Boolean. Perform parallel processing? A parallel backend
needs to be registered beforehand with
<code><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></code>. Moreover, a tiled spatial
vector should be supplied for <em>tiles</em>. Default: FALSE</p></td>
    </tr>
    <tr>
      <th>outdir</th>
      <td><p>Character. String specifying the path for the output raster
tiles/layer(s) of modeled response(s). Default: "."</p></td>
    </tr>
    <tr>
      <th>tile.rm</th>
      <td><p>Boolean. Should the tiles of modeled response(s) be removed
from disk after the tile merging process? Default: TRUE</p></td>
    </tr>
    <tr>
      <th>extension</th>
      <td><p>Character. String specifying the extension for the output
raster layer(s) of modeled response(s). Default: ".tif"</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Boolean. Show warning messages in the console? Default: FALSE</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments as for <code><a href='https://rdrr.io/pkg/terra/man/writeRaster.html'>writeRaster</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Multi-layer or single-layer SpatRaster with modeled response(s).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The predictive modeling process is cell-wise, which means that it operates on
a cell-by-cell basis. For a given cell occurring in the geographic space
supported by a raster layer, the predictive modeling engine first identifies
the <em>n</em> stratification units to which the given cell is most similar
(i.e., 'winning stratification units'). The engine is able to identify the
winning stratification units thanks to the user-provided set of landscape
similarity layers <em>ls.rast</em>. Subsequently, the response value from the
representative observation for each winning stratification unit is
identified. In the case of a continuous response, a weighted average of
representative response values is performed. For each representative response
value, the weight is proportional to the corresponding stratification unit's
landscape similarity value in the given cell. The result of the weighted
average is assigned as the response value in the given cell. In the case of a
categorical response, the modal value from the representative response values
of the <em>n</em> winning stratification units is assigned to the given cell.</p>
<p>Note that the name for each raster layer in <em>ls.rast</em> should match the
numeric code of the corresponding stratification unit, which is obtained from
the column of numeric codes in <em>su.repobs</em>. Nevertheless, raster layer
names in <em>ls.rast</em> with a character prefix in the numeric code and/or
file extension should work fine (e.g., "su_1101.tif" instead of "1101"). If
the landscape similarity layers in <em>ls.rast</em> were created with
<code><a href='similarity.html'>similarity</a></code>, then raster layer names will not have any prefix
nor extension as part of the numeric code.</p>
<p>When dealing with large geographic spaces, high raster resolutions (i.e.,
small cell sizes), or both, a considerable amount of memory is required to
perform the modeling process. To reduce memory usage, the predictive modeling
engine performs tile-based processing of landscape similarity layers and
<strong>writes results directly on disk</strong>. Tile-based processing increases the
computational time, thus parallelization is allowed by setting up a parallel
backend. If parallelization is enabled, then care must be taken with the size
of the tiles since larger sizes will have a greater impact on memory usage.
Consequently, the parallel, tile-based processing will be less useful.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='similarity.html'>similarity</a></code>, <code><a href='observation.html'>observation</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/terra/'>terra</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"exdat"</span>, package <span class='op'>=</span> <span class='st'>"rassta"</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Multi-layer SpatRaster of landscape similarities</span></span>
<span class='r-in'><span class='va'>fls</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>p</span>, pattern <span class='op'>=</span> <span class='st'>"su_"</span>, full.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ls</span> <span class='op'>&lt;-</span> <span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></span><span class='op'>(</span><span class='va'>fls</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Numeric code and representative response value for stratification units</span></span>
<span class='r-in'><span class='va'>fro</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>p</span>, pattern <span class='op'>=</span> <span class='st'>"repobs.csv"</span>, full.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ro</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='va'>fro</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Extract only those stratification units with representative value</span></span>
<span class='r-in'><span class='va'>ls</span> <span class='op'>&lt;-</span> <span class='va'>ls</span><span class='op'>[[</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ro</span><span class='op'>$</span><span class='va'>SU</span><span class='op'>)</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'><span class='co'># SpatVector with processing tiles</span></span>
<span class='r-in'><span class='va'>fti</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>p</span>, pattern <span class='op'>=</span> <span class='st'>"tiles.shp"</span>, full.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ti</span> <span class='op'>&lt;-</span> <span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/vect.html'>vect</a></span><span class='op'>(</span><span class='va'>fti</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Directory for temporary files</span></span>
<span class='r-in'><span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># Perform predictive modeling of continuous response</span></span>
<span class='r-in'><span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'>engine</span><span class='op'>(</span>res.type <span class='op'>=</span> <span class='st'>"cont"</span>, ls.rast <span class='op'>=</span> <span class='va'>ls</span>, n.win <span class='op'>=</span> <span class='fl'>2</span>, su.repobs <span class='op'>=</span> <span class='va'>ro</span>,</span>
<span class='r-in'>            tiles <span class='op'>=</span> <span class='va'>ti</span>, outdir <span class='op'>=</span> <span class='va'>o</span>, overwrite <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span class='r-in'>           <span class='op'>)</span></span>
<span class='r-in'><span class='co'># Plot modeled response</span></span>
<span class='r-in'><span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span><span class='op'>)</span><span class='op'>}</span></span>
<span class='r-in'><span class='co'># Clean temporary files</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.remove</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='va'>o</span>, pattern <span class='op'>=</span> <span class='st'>"soc.tif"</span>, full.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] TRUE</span>
<span class='r-in'><span class='co'>#</span></span>
<span class='r-in'><span class='co'>#-------</span></span>
<span class='r-in'><span class='co'># A note on non-explicit response's names (obtained from su.repobs):</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## This will result in incorrectly modeled response values</span></span>
<span class='r-in'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SOM"</span>, <span class='st'>"SOM_30cm"</span>, <span class='st'>"SOM_45cm"</span><span class='op'>)</span>    <span class='co'># SOM = soil organic matter</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Non explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 1 2 3</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 2</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 3</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## This will result in correct values</span></span>
<span class='r-in'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SOM_15cm"</span>, <span class='st'>"SOM_30cm"</span>, <span class='st'>"SOM_45cm"</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 1</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 2</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='va'>x</span><span class='op'>)</span>                            <span class='co'># Explicit</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 3</span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bryan A. Fuentes, Minerva J. Dorantes, John R. Tipton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


